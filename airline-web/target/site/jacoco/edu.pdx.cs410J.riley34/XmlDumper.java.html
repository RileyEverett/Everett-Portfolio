<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>XmlDumper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Airline Web/REST Project</a> &gt; <a href="index.source.html" class="el_package">edu.pdx.cs410J.riley34</a> &gt; <span class="el_source">XmlDumper.java</span></div><h1>XmlDumper.java</h1><pre class="source lang-java linenums">package edu.pdx.cs410J.riley34;

import edu.pdx.cs410J.AbstractAirline;
import edu.pdx.cs410J.AirlineDumper;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import javax.xml.transform.*;
import javax.xml.transform.dom.DOMSource;
import javax.xml.transform.stream.StreamResult;
import java.io.File;
import java.io.IOException;
import java.io.PrintWriter;
import java.io.StringWriter;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Collection;
import java.util.Date;

/**
 * The XmlDumper class for the CS410J airline Project
 */

<span class="nc" id="L30">public class XmlDumper implements AirlineDumper {</span>

	/**
	 * a constructor that sets file name of the xml dumper for the XmlDumper class
	 *
	 * @param fileName
	 */


	/**
	 * creates the airline section of the xml document and writes the data of the airline and its flights to it
	 *
	 * @param doc     the Document object that is being written to
	 * @param airline the airline object to be written to the xml file
	 */

	private static void createAirline(Document doc, Airline airline) {
<span class="nc" id="L47">		Element root = doc.createElement(&quot;airline&quot;);</span>
<span class="nc" id="L48">		doc.appendChild(root);</span>
<span class="nc" id="L49">		Node name = root.appendChild(doc.createElement(&quot;name&quot;));</span>
<span class="nc" id="L50">		name.appendChild(doc.createTextNode(airline.getName()));</span>
<span class="nc" id="L51">		ArrayList&lt;String&gt; flights = (ArrayList&lt;String&gt;) airline.getFlights();</span>
<span class="nc bnc" id="L52" title="All 2 branches missed.">		for (Object flightObj : flights) {</span>
<span class="nc" id="L53">			Flight flight = (Flight) flightObj;</span>
<span class="nc" id="L54">			Node flightNode = createFlight(doc, flight.getNumber(), flight.getSource(), flight.getDepartDate(), flight.getDestination(), flight.getArriveDate());</span>
<span class="nc" id="L55">			root.appendChild(flightNode);</span>
<span class="nc" id="L56">		}</span>
<span class="nc" id="L57">	}</span>

	/**
	 * creates a flight section in the xml document and writes the data of the airlines passed in flight to it
	 *
	 * @param doc           the Document object that is being written to
	 * @param flightNumber  int containing the flight's number
	 * @param sourceAirport string that holds a three letter airport code of the source airport
	 * @param departDate    Date object containing the date and time the flight departs
	 * @param destAirport   string that holds a three letter airport code of the destination airport
	 * @param arriveDate    Date object containing the date and time the flight arrives
	 * @return a Node containing the flights data in xml format
	 */

	private static Node createFlight(Document doc, int flightNumber, String sourceAirport, Date departDate, String destAirport, Date arriveDate) {
<span class="nc" id="L72">		Element flight = doc.createElement(&quot;flight&quot;);</span>
<span class="nc" id="L73">		Node number = flight.appendChild(doc.createElement(&quot;number&quot;));</span>
<span class="nc" id="L74">		number.appendChild(doc.createTextNode(Integer.toString(flightNumber)));</span>
<span class="nc" id="L75">		Node source = flight.appendChild(doc.createElement(&quot;src&quot;));</span>
<span class="nc" id="L76">		source.appendChild(doc.createTextNode(sourceAirport));</span>
<span class="nc" id="L77">		Node depart = flight.appendChild(doc.createElement(&quot;depart&quot;));</span>
<span class="nc" id="L78">		Calendar departCal = Calendar.getInstance();</span>
<span class="nc" id="L79">		departCal.setTime(departDate);</span>
<span class="nc" id="L80">		Element DateForDepart = doc.createElement(&quot;date&quot;);</span>
<span class="nc" id="L81">		DateForDepart.setAttribute(&quot;day&quot;, Integer.toString(departCal.get(Calendar.DAY_OF_MONTH)));</span>
<span class="nc" id="L82">		DateForDepart.setAttribute(&quot;month&quot;, Integer.toString(departCal.get(Calendar.MONTH) + 1));</span>
<span class="nc" id="L83">		DateForDepart.setAttribute(&quot;year&quot;, Integer.toString(departCal.get(Calendar.YEAR)));</span>
<span class="nc" id="L84">		Element timeForDepart = doc.createElement(&quot;time&quot;);</span>
<span class="nc" id="L85">		timeForDepart.setAttribute(&quot;hour&quot;, Integer.toString(departCal.get(Calendar.HOUR_OF_DAY)));</span>
<span class="nc" id="L86">		timeForDepart.setAttribute(&quot;minute&quot;, Integer.toString(departCal.get(Calendar.MINUTE)));</span>
<span class="nc" id="L87">		depart.appendChild(DateForDepart);</span>
<span class="nc" id="L88">		depart.appendChild(timeForDepart);</span>
<span class="nc" id="L89">		Node dest = flight.appendChild(doc.createElement(&quot;dest&quot;));</span>
<span class="nc" id="L90">		dest.appendChild(doc.createTextNode(destAirport));</span>
<span class="nc" id="L91">		Node arrive = flight.appendChild(doc.createElement(&quot;arrive&quot;));</span>
<span class="nc" id="L92">		Calendar arriveCal = Calendar.getInstance();</span>
<span class="nc" id="L93">		arriveCal.setTime(arriveDate);</span>
<span class="nc" id="L94">		Element DateForArrive = doc.createElement(&quot;date&quot;);</span>
<span class="nc" id="L95">		DateForArrive.setAttribute(&quot;day&quot;, Integer.toString(arriveCal.get(Calendar.DAY_OF_MONTH)));</span>
<span class="nc" id="L96">		DateForArrive.setAttribute(&quot;month&quot;, Integer.toString(arriveCal.get(Calendar.MONTH) + 1));</span>
<span class="nc" id="L97">		DateForArrive.setAttribute(&quot;year&quot;, Integer.toString(arriveCal.get(Calendar.YEAR)));</span>
<span class="nc" id="L98">		Element timeForArrive = doc.createElement(&quot;time&quot;);</span>
<span class="nc" id="L99">		timeForArrive.setAttribute(&quot;hour&quot;, Integer.toString(arriveCal.get(Calendar.HOUR_OF_DAY)));</span>
<span class="nc" id="L100">		timeForArrive.setAttribute(&quot;minute&quot;, Integer.toString(arriveCal.get(Calendar.MINUTE)));</span>
<span class="nc" id="L101">		arrive.appendChild(DateForArrive);</span>
<span class="nc" id="L102">		arrive.appendChild(timeForArrive);</span>
<span class="nc" id="L103">		return flight;</span>
	}

	/**
	 * creates an xml document and writes the data of an airline and its flights to it
	 *
	 * @param abstractAirline an abstractAirline object to be written to an xml document
	 * @throws IOException
	 */

	@Override
	public void dump(AbstractAirline abstractAirline) throws IOException {
		try {
<span class="nc" id="L116">			DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();</span>
<span class="nc" id="L117">			factory.setValidating(true);</span>
<span class="nc" id="L118">			DocumentBuilder builder = factory.newDocumentBuilder();</span>
<span class="nc" id="L119">			Document doc = builder.newDocument();</span>

<span class="nc bnc" id="L121" title="All 2 branches missed.">			if(abstractAirline != null) {</span>
<span class="nc" id="L122">				createAirline(doc, (Airline) abstractAirline);</span>
			}

<span class="nc" id="L125">			TransformerFactory transformerFactory = TransformerFactory.newInstance();</span>
<span class="nc" id="L126">			Transformer transF = transformerFactory.newTransformer();</span>
<span class="nc" id="L127">			transF.setOutputProperty(OutputKeys.DOCTYPE_SYSTEM, &quot;http://www.cs.pdx.edu/~whitlock/dtds/airline.dtd&quot;);</span>
<span class="nc" id="L128">			transF.setOutputProperty(OutputKeys.INDENT, &quot;yes&quot;);</span>
<span class="nc" id="L129">			transF.setOutputProperty(OutputKeys.ENCODING, &quot;us-ascii&quot;);</span>
<span class="nc" id="L130">			DOMSource source = new DOMSource(doc);</span>

			/*
			File myFile = new File(xmlFileName);
			StreamResult file = new StreamResult(myFile);
			transF.transform(source, file);
			*/

<span class="nc" id="L138">		} catch (ParserConfigurationException | TransformerException ex) {</span>
<span class="nc" id="L139">			throw new IOException(ex);</span>
<span class="nc" id="L140">		}</span>
<span class="nc" id="L141">	}</span>

	public void dumpToServer(AbstractAirline abstractAirline, HttpServletResponse response) throws IOException {
		try {
<span class="nc" id="L145">			DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();</span>
<span class="nc" id="L146">			factory.setValidating(true);</span>
<span class="nc" id="L147">			DocumentBuilder builder = factory.newDocumentBuilder();</span>
<span class="nc" id="L148">			Document doc = builder.newDocument();</span>

<span class="nc bnc" id="L150" title="All 2 branches missed.">			if(abstractAirline != null) {</span>
<span class="nc" id="L151">				createAirline(doc, (Airline) abstractAirline);</span>
			}

<span class="nc" id="L154">			TransformerFactory transformerFactory = TransformerFactory.newInstance();</span>
<span class="nc" id="L155">			Transformer transF = transformerFactory.newTransformer();</span>
<span class="nc" id="L156">			transF.setOutputProperty(OutputKeys.DOCTYPE_SYSTEM, &quot;http://www.cs.pdx.edu/~whitlock/dtds/airline.dtd&quot;);</span>
<span class="nc" id="L157">			transF.setOutputProperty(OutputKeys.INDENT, &quot;yes&quot;);</span>
<span class="nc" id="L158">			transF.setOutputProperty(OutputKeys.ENCODING, &quot;us-ascii&quot;);</span>

<span class="nc" id="L160">			StringWriter sw = new StringWriter();</span>
<span class="nc" id="L161">			transF.transform(new DOMSource(doc), new StreamResult(sw));</span>
<span class="nc" id="L162">			PrintWriter pw = response.getWriter();</span>
<span class="nc" id="L163">			pw.println(sw.toString());</span>
<span class="nc" id="L164">			pw.flush();</span>

<span class="nc" id="L166">		} catch (ParserConfigurationException | TransformerException | IOException ex) {</span>
<span class="nc" id="L167">			throw new IOException(ex);</span>
<span class="nc" id="L168">		}</span>
<span class="nc" id="L169">	}</span>

	public void dumpConnectingFlightsToServer(Airline airline, Collection flights, HttpServletResponse response) throws IOException {
		try {
<span class="nc" id="L173">			DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();</span>
<span class="nc" id="L174">			factory.setValidating(true);</span>
<span class="nc" id="L175">			DocumentBuilder builder = factory.newDocumentBuilder();</span>
<span class="nc" id="L176">			Document doc = builder.newDocument();</span>

<span class="nc" id="L178">			Element root = doc.createElement(&quot;airline&quot;);</span>
<span class="nc" id="L179">			doc.appendChild(root);</span>
<span class="nc" id="L180">			Node name = root.appendChild(doc.createElement(&quot;name&quot;));</span>
<span class="nc" id="L181">			name.appendChild(doc.createTextNode(airline.getName()));</span>

<span class="nc bnc" id="L183" title="All 2 branches missed.">			if(flights != null) {</span>
<span class="nc" id="L184">				Object[] flightList = flights.toArray();</span>
<span class="nc bnc" id="L185" title="All 2 branches missed.">				for (Object flight : flightList) {</span>
<span class="nc" id="L186">					Flight currentFlight = (Flight) flight;</span>
<span class="nc" id="L187">					Node flightNode = createFlight(doc, currentFlight.getNumber(), currentFlight.getSource(), currentFlight.getDepartDate(),</span>
<span class="nc" id="L188">							currentFlight.getDestination(), currentFlight.getArriveDate());</span>
<span class="nc" id="L189">					root.appendChild(flightNode);</span>
				}
			}

<span class="nc" id="L193">			TransformerFactory transformerFactory = TransformerFactory.newInstance();</span>
<span class="nc" id="L194">			Transformer transF = transformerFactory.newTransformer();</span>
<span class="nc" id="L195">			transF.setOutputProperty(OutputKeys.DOCTYPE_SYSTEM, &quot;http://www.cs.pdx.edu/~whitlock/dtds/airline.dtd&quot;);</span>
<span class="nc" id="L196">			transF.setOutputProperty(OutputKeys.INDENT, &quot;yes&quot;);</span>
<span class="nc" id="L197">			transF.setOutputProperty(OutputKeys.ENCODING, &quot;us-ascii&quot;);</span>

<span class="nc" id="L199">			StringWriter sw = new StringWriter();</span>
<span class="nc" id="L200">			transF.transform(new DOMSource(doc), new StreamResult(sw));</span>
<span class="nc" id="L201">			PrintWriter pw = response.getWriter();</span>
<span class="nc" id="L202">			pw.println(sw.toString());</span>
<span class="nc" id="L203">			pw.flush();</span>

<span class="nc" id="L205">		} catch (ParserConfigurationException | TransformerException | IOException ex) {</span>
<span class="nc" id="L206">			throw new IOException(ex);</span>
<span class="nc" id="L207">		}</span>
<span class="nc" id="L208">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>