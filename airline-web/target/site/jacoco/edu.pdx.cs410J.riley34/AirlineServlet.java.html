<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AirlineServlet.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Airline Web/REST Project</a> &gt; <a href="index.source.html" class="el_package">edu.pdx.cs410J.riley34</a> &gt; <span class="el_source">AirlineServlet.java</span></div><h1>AirlineServlet.java</h1><pre class="source lang-java linenums">package edu.pdx.cs410J.riley34;

import com.google.common.annotations.VisibleForTesting;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.io.PrintWriter;
import java.util.*;
import java.util.concurrent.ArrayBlockingQueue;

/**
 * This servlet ultimately provides a REST API for working with an
 * &lt;code&gt;Airline&lt;/code&gt;.  However, in its current state, it is an example
 * of how to use HTTP and Java servlets to store simple dictionary of words
 * and their definitions.
 */
<span class="nc" id="L20">public class AirlineServlet extends HttpServlet {</span>
	static final String WORD_PARAMETER = &quot;word&quot;;
	static final String DEFINITION_PARAMETER = &quot;definition&quot;;

<span class="nc" id="L24">	private final Map&lt;String, String&gt; dictionary = new HashMap&lt;&gt;();</span>
<span class="nc" id="L25">	private final Collection&lt;Airline&gt; airlines = new ArrayList&lt;&gt;();</span>


	/**
	 * Handles an HTTP GET request from a client by writing the definition of the
	 * word specified in the &quot;word&quot; HTTP parameter to the HTTP response.  If the
	 * &quot;word&quot; parameter is not specified, all of the entries in the dictionary
	 * are written to the HTTP response.
	 */
	@Override
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
<span class="nc" id="L36">		response.setContentType(&quot;text/plain&quot;);</span>

<span class="nc" id="L38">		String airlineName = getParameter(&quot;airline&quot;, request);</span>
<span class="nc bnc" id="L39" title="All 2 branches missed.">		if(airlineName == null) {</span>
<span class="nc" id="L40">			missingRequiredParameter(response, &quot;airline&quot;);</span>
		} else {
<span class="nc" id="L42">			String src = getParameter(&quot;src&quot;, request);</span>
<span class="nc" id="L43">			String dest = getParameter(&quot;dest&quot;, request);</span>
<span class="nc bnc" id="L44" title="All 4 branches missed.">			if(src == null || dest == null) {</span>
<span class="nc" id="L45">				writeAllAirlineEntries(airlineName, response);</span>
			} else {
<span class="nc" id="L47">				findConnectingFlights(airlineName, src, dest, response);</span>
			}
		}
<span class="nc" id="L50">	}</span>

	private void findConnectingFlights(String airlineName, String src, String dest, HttpServletResponse response) throws IOException {
<span class="nc" id="L53">		XmlDumper dumper = new XmlDumper();</span>
<span class="nc" id="L54">		boolean validAirlineFlag = false;</span>
<span class="nc" id="L55">		Object[] alList = airlines.toArray();</span>
<span class="nc" id="L56">		Airline targetAirline = null;</span>
<span class="nc bnc" id="L57" title="All 2 branches missed.">		for (Object alObject : alList) {</span>
<span class="nc" id="L58">			Airline currentAirline = (Airline) alObject;</span>
<span class="nc bnc" id="L59" title="All 2 branches missed.">			if(currentAirline.getName().equalsIgnoreCase(airlineName)) {</span>
<span class="nc" id="L60">				targetAirline = currentAirline;</span>
<span class="nc" id="L61">				validAirlineFlag = true;</span>
			}
		}

<span class="nc bnc" id="L65" title="All 2 branches missed.">		if(!validAirlineFlag) {</span>
<span class="nc" id="L66">			response.sendError(HttpServletResponse.SC_PRECONDITION_FAILED, &quot;Airline Not Found&quot;);</span>
		} else {
<span class="nc" id="L68">			boolean flightFoundFlag = false;</span>
<span class="nc" id="L69">			Collection flights = targetAirline.getFlights();</span>
<span class="nc" id="L70">			Collection foundFlights = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L71">			Object[] flightList = flights.toArray();</span>
<span class="nc bnc" id="L72" title="All 2 branches missed.">			for(Object flight : flightList) {</span>
<span class="nc" id="L73">				Flight currentFlight = (Flight) flight;</span>
<span class="nc bnc" id="L74" title="All 4 branches missed.">				if(currentFlight.getSource().equals(src) &amp;&amp; currentFlight.getDestination().equals(dest)) {</span>
<span class="nc" id="L75">					foundFlights.add(currentFlight);</span>
<span class="nc" id="L76">					flightFoundFlag = true;</span>
				}
			}
<span class="nc bnc" id="L79" title="All 2 branches missed.">			if(!flightFoundFlag) {</span>
<span class="nc" id="L80">				response.sendError(HttpServletResponse.SC_PRECONDITION_FAILED, &quot;No Flights Found Between&quot; + src + &quot; and &quot; + dest + &quot;.&quot;);</span>
			} else {
<span class="nc" id="L82">				dumper.dumpConnectingFlightsToServer(targetAirline, foundFlights, response);</span>
<span class="nc" id="L83">				response.setStatus(HttpServletResponse.SC_OK);</span>
			}
		}
<span class="nc" id="L86">	}</span>


	private void writeAllAirlineEntries(String airlineName, HttpServletResponse response) throws IOException {
<span class="nc" id="L90">		XmlDumper dumper = new XmlDumper();</span>
<span class="nc" id="L91">		boolean validAirlineFlag = false;</span>
<span class="nc" id="L92">		Object[] alList = airlines.toArray();</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">		for (Object alObject : alList) {</span>
<span class="nc" id="L94">			Airline currentAirline = (Airline) alObject;</span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">			if(currentAirline.getName().equalsIgnoreCase(airlineName)) {</span>
<span class="nc" id="L96">				dumper.dumpToServer((Airline) alObject, response);</span>
<span class="nc" id="L97">				validAirlineFlag = true;</span>
			}
		}

<span class="nc bnc" id="L101" title="All 2 branches missed.">		if(!validAirlineFlag) {</span>
<span class="nc" id="L102">			response.sendError(HttpServletResponse.SC_PRECONDITION_FAILED, &quot;Airline Not Found&quot;);</span>
		} else {
<span class="nc" id="L104">			response.setStatus(HttpServletResponse.SC_OK);</span>
		}
<span class="nc" id="L106">	}</span>

	/**
	 * Handles an HTTP POST request by storing the dictionary entry for the
	 * &quot;word&quot; and &quot;definition&quot; request parameters.  It writes the dictionary
	 * entry to the HTTP response.
	 */
	@Override
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
<span class="nc" id="L115">		response.setContentType(&quot;text/plain&quot;);</span>

<span class="nc" id="L117">		String airlineName = getParameter(&quot;airlineName&quot;, request);</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">		if(airlineName == null) {</span>
<span class="nc" id="L119">			missingRequiredParameter(response, &quot;airlineName&quot;);</span>
<span class="nc" id="L120">			return;</span>
		}
<span class="nc" id="L122">		String flightNumber = getParameter(&quot;flightNumber&quot;, request);</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">		if(flightNumber == null) {</span>
<span class="nc" id="L124">			missingRequiredParameter(response, &quot;flightNumber&quot;);</span>
<span class="nc" id="L125">			return;</span>
		}
<span class="nc" id="L127">		String source = getParameter(&quot;src&quot;, request);</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">		if(source == null) {</span>
<span class="nc" id="L129">			missingRequiredParameter(response, &quot;src&quot;);</span>
<span class="nc" id="L130">			return;</span>
		}
<span class="nc" id="L132">		String depart = getParameter(&quot;depart&quot;, request);</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">		if(depart == null) {</span>
<span class="nc" id="L134">			missingRequiredParameter(response, &quot;depart&quot;);</span>
<span class="nc" id="L135">			return;</span>
		}
<span class="nc" id="L137">		String dest = getParameter(&quot;dest&quot;, request);</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">		if(dest == null) {</span>
<span class="nc" id="L139">			missingRequiredParameter(response, &quot;dest&quot;);</span>
<span class="nc" id="L140">			return;</span>
		}
<span class="nc" id="L142">		String arrive = getParameter(&quot;arrive&quot;, request);</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">		if(arrive == null) {</span>
<span class="nc" id="L144">			missingRequiredParameter(response, &quot;arrive&quot;);</span>
<span class="nc" id="L145">			return;</span>
		}

<span class="nc" id="L148">		String[] departList = depart.split(&quot; &quot;);</span>
<span class="nc" id="L149">		String departDate = departList[0];</span>
<span class="nc" id="L150">		String departTime = departList[1];</span>
<span class="nc" id="L151">		String departSuffix = departList[2];</span>

<span class="nc" id="L153">		String[] arriveList = arrive.split(&quot; &quot;);</span>
<span class="nc" id="L154">		String arriveDate = arriveList[0];</span>
<span class="nc" id="L155">		String arriveTime = arriveList[1];</span>
<span class="nc" id="L156">		String arriveSuffix = arriveList[2];</span>
		try {
<span class="nc" id="L158">			Airline airline = new Airline(airlineName);</span>
<span class="nc" id="L159">			Flight flight = new Flight(Integer.parseInt(flightNumber), source, departDate, departTime, departSuffix, dest, arriveDate, arriveTime, arriveSuffix);</span>

<span class="nc" id="L161">			Object[] list = airlines.toArray();</span>
<span class="nc" id="L162">			boolean airlineExistsFlag = false;</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">			for (Object alObject : list) {</span>
<span class="nc" id="L164">				Airline currentAirline = (Airline) alObject;</span>
<span class="nc bnc" id="L165" title="All 2 branches missed.">				if(currentAirline.getName().equalsIgnoreCase(airlineName)) {</span>
<span class="nc" id="L166">					airlineExistsFlag = true;</span>
<span class="nc" id="L167">					break;</span>
				}
			}
<span class="nc bnc" id="L170" title="All 2 branches missed.">			if(!airlineExistsFlag) {</span>
<span class="nc" id="L171">				airline.addFlight(flight);</span>
<span class="nc" id="L172">				this.airlines.add(airline);</span>
			} else {
<span class="nc" id="L174">				Object[] alList = airlines.toArray();</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">				for (Object alObject : alList) {</span>
<span class="nc" id="L176">					Airline currentAirline = (Airline) alObject;</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">					if(currentAirline.getName().equalsIgnoreCase(airlineName)) {</span>
<span class="nc" id="L178">						currentAirline.addFlight(flight);</span>
					}
				}
			}

<span class="nc" id="L183">			PrintWriter pw = response.getWriter();</span>
<span class="nc bnc" id="L184" title="All 2 branches missed.">			if(!airlineExistsFlag) {</span>
<span class="nc" id="L185">				pw.println(&quot;Created new Airline &quot; + airlineName + &quot;.&quot;);</span>
			}
<span class="nc" id="L187">			pw.println(&quot;Added Flight &quot; + flightNumber + &quot; to &quot; + airlineName + &quot;.&quot;);</span>
<span class="nc" id="L188">			pw.flush();</span>

<span class="nc" id="L190">		} catch (IllegalArgumentException ex) {</span>
<span class="nc" id="L191">			response.sendError(HttpServletResponse.SC_PRECONDITION_FAILED, &quot;Input Incorrectly Formatted!&quot;);</span>
<span class="nc" id="L192">			return;</span>
<span class="nc" id="L193">		}</span>
<span class="nc" id="L194">		response.setStatus(HttpServletResponse.SC_OK);</span>

<span class="nc" id="L196">	}</span>

	/**
	 * Handles an HTTP DELETE request by removing all dictionary entries.  This
	 * behavior is exposed for testing purposes only.  It's probably not
	 * something that you'd want a real application to expose.
	 */
	@Override
	protected void doDelete(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
<span class="nc" id="L205">		response.setContentType(&quot;text/plain&quot;);</span>

<span class="nc" id="L207">		this.dictionary.clear();</span>

<span class="nc" id="L209">		PrintWriter pw = response.getWriter();</span>
<span class="nc" id="L210">		pw.println(Messages.allDictionaryEntriesDeleted());</span>
<span class="nc" id="L211">		pw.flush();</span>

<span class="nc" id="L213">		response.setStatus(HttpServletResponse.SC_OK);</span>

<span class="nc" id="L215">	}</span>

	/**
	 * Writes an error message about a missing parameter to the HTTP response.
	 * &lt;p&gt;
	 * The text of the error message is created by {@link Messages#missingRequiredParameter(String)}
	 */
	private void missingRequiredParameter(HttpServletResponse response, String parameterName)
			throws IOException {
<span class="nc" id="L224">		String message = Messages.missingRequiredParameter(parameterName);</span>
<span class="nc" id="L225">		response.sendError(HttpServletResponse.SC_PRECONDITION_FAILED, message);</span>
<span class="nc" id="L226">	}</span>

	/**
	 * Writes the definition of the given word to the HTTP response.
	 * &lt;p&gt;
	 * The text of the message is formatted with
	 * {@link Messages#formatDictionaryEntry(String, String)}
	 */
	private void writeDefinition(String word, HttpServletResponse response) throws IOException {
<span class="nc" id="L235">		String definition = this.dictionary.get(word);</span>

<span class="nc bnc" id="L237" title="All 2 branches missed.">		if(definition == null) {</span>
<span class="nc" id="L238">			response.setStatus(HttpServletResponse.SC_NOT_FOUND);</span>

		} else {
<span class="nc" id="L241">			PrintWriter pw = response.getWriter();</span>
<span class="nc" id="L242">			pw.println(Messages.formatDictionaryEntry(word, definition));</span>

<span class="nc" id="L244">			pw.flush();</span>

<span class="nc" id="L246">			response.setStatus(HttpServletResponse.SC_OK);</span>
		}
<span class="nc" id="L248">	}</span>

	/**
	 * Writes all of the dictionary entries to the HTTP response.
	 * &lt;p&gt;
	 * The text of the message is formatted with
	 * {@link Messages#formatDictionaryEntry(String, String)}
	 */
	private void writeAllDictionaryEntries(HttpServletResponse response) throws IOException {
<span class="nc" id="L257">		PrintWriter pw = response.getWriter();</span>
<span class="nc" id="L258">		Messages.formatDictionaryEntries(pw, dictionary);</span>

<span class="nc" id="L260">		pw.flush();</span>

<span class="nc" id="L262">		response.setStatus(HttpServletResponse.SC_OK);</span>
<span class="nc" id="L263">	}</span>

	/**
	 * Returns the value of the HTTP request parameter with the given name.
	 *
	 * @return &lt;code&gt;null&lt;/code&gt; if the value of the parameter is
	 * &lt;code&gt;null&lt;/code&gt; or is the empty string
	 */
	private String getParameter(String name, HttpServletRequest request) {
<span class="nc" id="L272">		String value = request.getParameter(name);</span>
<span class="nc bnc" id="L273" title="All 4 branches missed.">		if(value == null || &quot;&quot;.equals(value)) {</span>
<span class="nc" id="L274">			return null;</span>

		} else {
<span class="nc" id="L277">			return value;</span>
		}
	}

	@VisibleForTesting
	String getDefinition(String word) {
<span class="nc" id="L283">		return this.dictionary.get(word);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>